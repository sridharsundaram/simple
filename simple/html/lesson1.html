<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html manifest="/lesson1.mf">
  <head>
    <title>Home</title>
    <script type="text/javascript" src="javascript/random.js"></script>
    <script type="text/javascript" src="javascript/mazaa.js"></script>
    <script type="text/javascript" src="javascript/lookup.js"></script>
    <script type="text/javascript" src="javascript/util.js"></script>
    <script type="text/javascript" src="javascript/template.js"></script>
    <script type="text/javascript" src="javascript/template_ops.js"></script>
    <script type="text/javascript" src="javascript/client.js"></script>
    <link rel="stylesheet" type="text/css" href="stylesheets/mazaa.css">
    <script type="text/javascript">
      var templateManager = null;
      function showResult(id, success) {
        if (success) {
          mazaa.playAudio(makeAbsoluteUrl('success.mp3'));
          increment(id, IDX_CORRECT);
          increaseScore(10);
          setTimeout(displayPractice, 1000);
        } else { // failure
          mazaa.playAudio(makeAbsoluteUrl('failure.mp3'));          
          increment(id, IDX_WRONG); 
          increaseScore(-5);
        }
      }

      function displayMain() {
        hideElement('section');
        hideElement('practice');
        showElement('main');
      }
      
      function displaySection(opt_index) {
        document.getElementById('score').innerHTML = '0';
        if (opt_index != null) {
          jsonData['current'] = jsonData.lesson.section[opt_index];
        }
        instantiatePage(jsonData);
        hideElement('main');
        showElement('section');
        hideElement('practice');
      }
      
      function displayPractice() {
        if (!templateManager) {
          templateManager = new TemplateManager();
        }
        jsonData['practice'] = createQuestions(jsonData['current'].list, 1, NUM_ANSWER_CHOICES);
        templateManager.applyTemplate(jsonData);
        hideElement('main');
        hideElement('section');
        showElement('practice');
        mazaa.playAudio(makeAbsoluteUrl(jsonData['practice'][0].question));
      }
      var IDX_VIEW = 0;
      var IDX_WRONG = 1;
      var IDX_CORRECT = 2;
      var tracking = {};
      
      function increment(id, idx) {
        if (!tracking[id]) {
          tracking[id] = [0, 0, 0];
        }
        tracking[id][idx]++;
      }
      
      function increaseScore(amt) {
        var score = document.getElementById('score');
        score.innerHTML = Math.round(score.innerHTML) + amt;
      }
      
      function updateCookie() {
        tracking['id'] = document.getElementById('mobile').innerHTML;
        var cookie_value = JSON.stringify(tracking);
        createMazaCookie('maza', encodeURIComponent(cookie_value), 365);
      }
    </script>
  </head>
  <body>
    <h1>Maza Learn English</h1>
    <table id="personal" data-bind-id="learner">
      <tr>
          <td>Mobile: <span id='mobile'>{{MobileNumber}}</span></td>
      </tr>
    </table>
    <div template-id="lesson" data-bind-id="lesson">
    <div id="main">
    <div id="menu" template-id="section" data-bind-id="section">
      <a href="javascript:void(0);" onclick="mazaa.playAudio(makeAbsoluteUrl('{{sound}}')); displaySection({{_index}}); return true;">
           <img xbl2:src="{{img}}" title="{{name}}" width=200>
      </a>
    </div>
    </div>
 
    <div id="section" template-id="currentsection" data-bind-id="current" style="display:none">    
      <h4>{{name}}</h4>
      <input type="button" value="Back" onclick="updateCookie(); displayMain();">
      <div id="scene" class="album">
        <div data-bind-id="list" class="img">
           <img height=100 width=100 xbl2:src="{{answer}}" 
                onclick="increment({{id}}, IDX_VIEW); mazaa.playAudio(makeAbsoluteUrl('{{question}}'))">
        </div>
      </div>
      <input type="button" value="Practice" onclick="displayPractice();">
    </div>  
    
    <div id="practice" style="display:none">
      <h4>Practice</h4>
      <div>Score: <span id="score" width=100 style="background-color: yellow"></span></div>
      <input type="button" value="Back" onclick="updateCookie(); displaySection();">
      <div id="scene1" template-id="practice" class="album" data-bind-id="practice">
        <div>
          <img src='sound_icon.jpg' id="testSoundIcon" height="50" width="50" 
               onclick="mazaa.playAudio(makeAbsoluteUrl('{{question}}'))">
        </div>
        <div class="img" data-bind-id="choices">
          <img width=100 height=100 xbl2:src="{{choice}}" onclick="showResult({{id}}, {{correct}});">
        </div>
      </div>
    </div>
    <script type="text/javascript">
      var jsonData = {{JSONDATA}};
      instantiatePage(jsonData);
    </script>
  </body>
</html>